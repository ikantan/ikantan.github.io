import{S as d,l as E,a as v,b as w,c as p,d as e,n as C,F as b,w as h,v as c,u as i,t as y,j as k,k as _}from"./index-2f76ba87.js";import{c as N,d as I,s as S,p as V}from"./User-0d557f88.js";class x{constructor(a,o,t,g){this.Email=a,this.Pass=o,this.NewPass=t,this.Code=g}TestEmail(){return new Promise((a,o)=>{if(!/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(this.Email))throw d("邮箱错误","请填写正确的邮箱",400),"";a()})}TestPass(){return new Promise((a,o)=>{const t=/^.{8,20}$/;if(this.Pass===void 0||!t.test(this.Pass))throw d("密码格式错误","大于等于8个字符",400),"";a()})}TestNewPass(){return new Promise((a,o)=>{const t=/^.{8,20}$/;if(this.NewPass===void 0||!t.test(this.Pass))throw d("密码格式错误","大于等于8个字符",400),"";a()})}TestCode(){return new Promise((a,o)=>{if(this.Code===void 0||this.Code.length<3)throw d("验证码错误","请填写正确的验证码",400),"";a()})}TestSave(){return Promise.all([this.TestEmail(),this.TestPass(),this.TestCode()])}TestInSave(){return Promise.all([this.TestPass(),this.TestNewPass()])}}const z={class:"h-screen z-[60] w-screen fixed left-0 right-0 top-0 bottom-0 m-auto bg-[rgba(0,0,0,0.5)]"},B={class:"absolute m-auto left-0 right-0 top-0 bottom-0"},R={class:"flex flex-col w-96 p-5 rounded-xl shadow-xl shadow-[var(--theme-shadow-bg)] bg-[var(--theme-model-bg)]"},U=e("h1",{class:"text-xl text-[var(--theme-title)]"},"重置密码",-1),A={class:"text-[var(--theme-title)] bg-[var(--theme-com-item)] shadow-lg shadow-[var(--theme-shadow-bg)] flex gap-5 items-center mt-6 p-4 rounded-lg"},$=e("label",{class:"w-14 whitespace-nowrap"},"旧密码:",-1),F={class:"text-[var(--theme-title)] bg-[var(--theme-com-item)] shadow-lg shadow-[var(--theme-shadow-bg)] flex gap-5 items-center mt-6 p-4 rounded-lg"},M=e("label",{class:"w-14 whitespace-nowrap"},"新密码:",-1),Z={class:"title-[var(--theme-title)] bg-[var(--theme-com-item)] shadow-lg shadow-[var(--theme-shadow-bg)] flex gap-5 items-center mt-6 p-4 rounded-lg"},j=e("label",{class:"w-14 whitespace-nowrap"},"邮箱:",-1),D={class:"title-[var(--theme-title)] bg-[var(--theme-com-item)] shadow-lg shadow-[var(--theme-shadow-bg)] flex gap-5 relative items-center mt-6 p-4 rounded-lg"},G=e("label",{class:"w-14 whitespace-nowrap"},"验证码:",-1),L=["disabled"],O={class:"title-[var(--theme-title)] bg-[var(--theme-com-item)] shadow-lg shadow-[var(--theme-shadow-bg)] flex gap-5 items-center mt-6 p-4 rounded-lg"},q=e("label",{class:"w-14 whitespace-nowrap"},"密码:",-1),H={__name:"restart_pass",props:{is_login:Boolean,move_node:Function},setup(u){const a=E(),o=u;let t=new x;const g=()=>{t.TestInSave().then(()=>{N(t.Pass,t.NewPass).then(r=>{d("重置成功",null,200),I(),o.move_node(),a.go(0)}).catch(r=>{d("重置失败",r.data.message,400)})})},l=new x,m=v(0),f=()=>{l.TestEmail().then(()=>{S(l.Email).then(r=>{d("发送成功","请查看验证码",200),m.value=60;const s=setInterval(()=>{m.value--,m.value===0&&clearInterval(s)},1e3)}).catch(r=>d(r.data.message,null,400))})},P=()=>{l.TestSave().then(()=>{V(l.Email,l.Pass,l.Code).then(r=>{d("重置成功","快去登录吧",200),o.move_node()}).catch(r=>{d(r.data.message,null,400)})})},T=v(!0);return(r,s)=>(w(),p("div",z,[e("div",B,[e("div",{class:C(["w-full animate__animated h-full text-white flex justify-center items-center",T.value?"animate__fadeIn":"animate__fadeOut"])},[e("div",R,[U,o.is_login?(w(),p(b,{key:0},[e("div",A,[$,h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>i(t).Pass=n),class:"flex-1 bg-[rgba(0,0,0,0)] border-0 outline-0",type:"text",name:"",id:"",placeholder:"请输入旧密码"},null,512),[[c,i(t).Pass]])]),e("div",F,[M,h(e("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>i(t).NewPass=n),class:"flex-1 bg-[rgba(0,0,0,0)] border-0 outline-0",type:"text",name:"",id:"",placeholder:"请输入新密码"},null,512),[[c,i(t).NewPass]])]),e("button",{onClick:g,class:"mt-5 p-2 mx-4 bg-green-600 rounded-xl text-sm"},"重置密码 ")],64)):(w(),p(b,{key:1},[e("div",Z,[j,h(e("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>i(l).Email=n),class:"flex-1 bg-[rgba(0,0,0,0)] border-0 outline-0",type:"text",name:"",id:"",placeholder:"请输入邮箱@Gmail"},null,512),[[c,i(l).Email]])]),e("div",D,[G,h(e("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>i(l).Code=n),class:"flex-1 bg-[rgba(0,0,0,0)] border-0 outline-0",type:"text",name:"",id:"",placeholder:"验证码"},null,512),[[c,i(l).Code]]),e("button",{class:"absolute right-5 z-10",disabled:m.value!==0,onClick:f},y(m.value===0?"发送验证码":m.value),9,L)]),e("div",O,[q,h(e("input",{"onUpdate:modelValue":s[4]||(s[4]=n=>i(l).Pass=n),class:"flex-1 bg-[rgba(0,0,0,0)] border-0 outline-0",type:"text",name:"",id:"",placeholder:"请输入新密码"},null,512),[[c,i(l).Pass]])]),e("button",{onClick:P,class:"mt-5 p-2 title-[var(--theme-title)] mx-4 bg-green-600 rounded-xl text-sm"},"重置密码 ")],64)),e("button",{onClick:s[5]||(s[5]=n=>o.move_node()),class:"text-[var(--theme-title)] bg-[var(--theme-button-imp)] shadow-[var(--theme-shadow-bg)] mt-2 w-f p-2 mx-4 shadow-lg rounded-xl text-sm"},"取消重置 ")])],2)])]))}},Q=u=>{const o=k(H,{is_login:u,move_node:()=>{_(null,document.getElementById("Model"))}});_(o,document.getElementById("Model"))};export{Q as R};
